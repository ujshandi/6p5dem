<?php ini_set('max_execution_time', 700);if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class get_xml extends MY_Frontpage
{		public function __construct(){		parent::__construct();		$this->load->helper('path');		$this->load->helper('xml');		$this->load->model('mdl_xml');	}		function index(){	/*		$u = $this->print_xml();				foreach( $u['unitkantor'] as $k => $v ){			echo $k;		} */		$this->print_xml();	}	
	function print_xml()
	{		/*		$xml = simplexml_load_file("http://sik.dephub.go.id/report/pegawai/pegawai.xml");		echo $xml->getName() . "<br />";		*/		$url = 'http://sik.dephub.go.id/report/pegawai/pegawai.xml';		$file = file_get_contents($url); 		$pegawai_xml = simplexml_load_string($file);		$users_array = array();				$i=0;		foreach($pegawai_xml->unitkantor as $u){			//echo (string)$u->nama . "<br/>";			/*echo (string)$u->nama;			echo (string)$u->tgl_lahir;			$ARR_TGL_LAHIR = explode("-", $TGL_LAHIR);			$TGL = $ARR_TGL_LAHIR[2];			$BLN = $ARR_TGL_LAHIR[1];			$THN = $ARR_TGL_LAHIR[0];			$V_TGL_LAHIR = $TGL . '/' . $BLN . '/' . $THN;			$data['TGL_LAHIR'] = "to_date('".$V_TGL_LAHIR."', 'dd/mm/yyyy')"; */									$data['NAMA'] =  (string)$u->nama;			$TGL_LAHIR =  (string)$u->tgl_lahir;			$ARR_TGL_LAHIR = explode("-", $TGL_LAHIR);			$TGL = $ARR_TGL_LAHIR[2];			$BLN = $ARR_TGL_LAHIR[1];			$THN = $ARR_TGL_LAHIR[0];			$V_TGL_LAHIR = $TGL . '/' . $BLN . '/' . $THN;			/*$data['TGL_LAHIR'] = "to_date('".$V_TGL_LAHIR."', 'dd/mm/yyyy')";*/			$data['TGL_LAHIR'] = (string)$u->tgl_lahir;			$data['KELAMIN'] =  (string)$u->kelamin;			$data['UNITKANTOR'] =  (string)$u->unitkantor;			$data['KERJAUNIT'] =  (string)$u->kerjaunit;			$data['TINGKATDIK'] =  (string)$u->tingkatdik;			$data['JURUSAN'] =  (string)$u->jurusan;			$data['SEKOLAH'] =  (string)$u->sekolah;			$data['GOLPNS'] =  (string)$u->golpns;						/*$users_array[ (string)$u->email ]['name'] = (string)$u->name;			$users_array[ (string)$u->email ]['email'] = (string)$u->email;			$users_array[ (string)$u->email ]['password'] = (string)$u->password;			*/			/*			$users_array[ (string)$u->unitkantor ]['unitkantor'] = (string)$u->unitkantor;			foreach($u->unitkantor as $p)			{				@$users_array[(string)$u->unitkantor]['nama'] = explode("," ,(string)$p->nama);			} */		//	$i++;					}		echo "total:" . $i;		  //$this->load->view('cron/test', $data); 		//return $users_array;	
	}		function get_count(){		/*		$url = 'http://sik.dephub.go.id/report/pegawai/pegawai.xml';		$file = file_get_contents($url); 		$pegawai_xml = simplexml_load_string($file);				print count($pegawai_xml->unitkantor) */;			$this->mdl_xml->truncate_data();			}		function insert(){				$url = 'http://sik.dephub.go.id/report/pegawai/pegawai.xml';		$file = file_get_contents($url); 		$dataxml = simplexml_load_string($file)  or die("Error: Cannot create object");		$i=0;				$this->mdl_xml->truncate_data();				foreach($dataxml->children() as $rows){			//echo $rows->nama . '<br/>' . $rows->tgl_lahir. '<br/>' . $rows->tingkatdik;						$STRNAMA = "$rows->nama";			$NAMA = str_replace("'", "\''", $STRNAMA);			$data['NAMA'] = $NAMA;			$TGL_LAHIR =  $rows->tgl_lahir;			$ARR_TGL_LAHIR = explode("-", $TGL_LAHIR);			$TGL = $ARR_TGL_LAHIR[2];			$BLN = $ARR_TGL_LAHIR[1];			$THN = $ARR_TGL_LAHIR[0];			if ($TGL='00') $TGL='17';			if ($BLN='00') $BLN='08';			if ($THN='0000') $THN='1945';						$V_TGL_LAHIR = $TGL . '/' . $BLN . '/' . $THN;						$data['TGL_LAHIR'] = "to_date('".$V_TGL_LAHIR."', 'dd/mm/yyyy')";			$data['KELAMIN'] =  "$rows->kelamin";			$data['UNITKANTOR'] = "$rows->unitkantor";			$data['KERJAUNIT'] = "$rows->kerjaunit";			$data['TINGKATDIK'] = "$rows->tingkatdik";			$data['JURUSAN'] = "$rows->jurusan";			$data['SEKOLAH'] = "$rows->sekolah";			$data['GOLPNS'] = "$rows->golpns";									$this->mdl_xml->insert($data); 			$i++;		} 		/*			$data['NAMA'] =  'aa';			$TGL_LAHIR =  '1958-11-20';			$ARR_TGL_LAHIR = explode("-", $TGL_LAHIR);			$TGL = $ARR_TGL_LAHIR[2];			$BLN = $ARR_TGL_LAHIR[1];			$THN = $ARR_TGL_LAHIR[0];			$V_TGL_LAHIR = $TGL . '/' . $BLN . '/' . $THN;			$data['TGL_LAHIR'] = "to_date('".$V_TGL_LAHIR."', 'dd/mm/yyyy')";			$data['KELAMIN'] =  1;			$data['UNITKANTOR'] =  101;			$data['KERJAUNIT'] =  1018;			$data['TINGKATDIK'] =  '04';			$data['JURUSAN'] =  'HUKUM';			$data['SEKOLAH'] =  'UNWIKU';			$data['GOLPNS'] =  'f';			$this->mdl_xml->insert($data); */		echo $i;	}
}